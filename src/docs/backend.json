
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SanteConnect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the user."
        },
        "role": {
          "type": "string",
          "description": "The role or plan of the user.",
          "enum": ["Gratuit", "Standard", "Premium", "Admin", "Pro", "Aidant"]
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "role"
      ]
    },
    "MedicalRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Medical Record",
      "type": "object",
      "description": "Represents a user's comprehensive medical record.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "vaccinations": {
          "type": "array",
          "items": { "type": "object", "properties": { "name": { "type": "string" }, "date": { "type": "string", "format": "date-time" } } }
        },
        "consultationHistory": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": { "date": { "type": "string", "format": "date-time" }, "doctor": { "type": "string" }, "summary": { "type": "string" } }
          }
        }
      },
      "required": ["id", "userId"]
    },
    "Reminder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reminder",
      "type": "object",
      "description": "Represents a medication or appointment reminder.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "type": { "type": "string", "enum": ["medication", "appointment"] },
        "title": { "type": "string" },
        "dateTime": { "type": "string", "format": "date-time" },
        "isSent": { "type": "boolean" }
      },
      "required": ["id", "userId", "type", "title", "dateTime"]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat Message",
      "type": "object",
      "description": "Represents a single message in an AI chat session.",
      "properties": {
        "id": { "type": "string" },
        "role": { "type": "string", "enum": ["user", "model"] },
        "content": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "role", "content", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores user profiles."
        }
      },
      {
        "path": "/records/{recordId}",
        "definition": {
          "entityName": "MedicalRecord",
          "schema": { "$ref": "#/backend/entities/MedicalRecord" },
          "description": "Stores medical records for users. Rules will enforce that a user can only access their own record."
        }
      },
      {
        "path": "/reminders/{reminderId}",
        "definition": {
          "entityName": "Reminder",
          "schema": { "$ref": "#/backend/entities/Reminder" },
          "description": "Stores all reminders. Rules will enforce that a user can only access their own reminders."
        }
      },
      {
        "path": "/chat_sessions/{userId}/{sessionId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": { "$ref": "#/backend/entities/ChatMessage" },
          "description": "Stores messages for a specific user's chat session. Path-based ownership."
        }
      },
      {
        "path": "/admin/{docId}",
        "definition": {
          "description": "General admin collection for platform supervision and statistics."
        }
      }
    ],
    "reasoning": "This new structure aligns with the modular product vision. It separates data by domain (records, reminders, chat) rather than nesting everything under users. This will make it easier to build out features like Family or Pro accounts, as data access logic in security rules will be more flexible (e.g., an 'aidant' can be granted access to a specific user's records). Path-based ownership is still used where appropriate, like for chat sessions."
  }
}
