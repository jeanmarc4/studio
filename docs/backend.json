
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SanteConnect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the user."
        },
        "role": {
          "type": "string",
          "description": "The role or plan of the user.",
          "enum": ["Standard", "Premium", "Admin"]
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "role"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator user of the SanteConnect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Admin)"
        },
        "role": {
          "type": "string",
          "description": "The role of the administrator (e.g., superadmin, editor)."
        },
        "permissions": {
          "type": "array",
          "description": "List of permisions for the admin user.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "role"
      ]
    },
    "MedicalProfessional": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MedicalProfessional",
      "type": "object",
      "description": "Represents a doctor, pharmacy, or other healthcare provider.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the medical professional entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the medical professional or institution."
        },
        "type": {
          "type": "string",
          "description": "The type of medical professional (e.g., doctor, pharmacy)."
        },
        "specialty": {
          "type": "string",
          "description": "The medical specialty of the professional (e.g., cardiology, pediatrics)."
        },
        "address": {
          "type": "string",
          "description": "The address of the medical professional."
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the medical professional."
        },
        "location": {
          "type": "string",
          "description": "The GPS coordinates for the medical professional."
        }
      },
      "required": [
        "id",
        "name",
        "type"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents a scheduled appointment between a user and a medical professional.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the appointment entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Appointment)"
        },
        "medicalProfessionalId": {
          "type": "string",
          "description": "Reference to MedicalProfessional. (Relationship: MedicalProfessional 1:N Appointment)"
        },
        "dateTime": {
          "type": "string",
          "description": "The date and time of the appointment.",
          "format": "date-time"
        },
        "reason": {
          "type": "string",
          "description": "The reason for the appointment."
        },
        "status": {
          "type": "string",
          "description": "The status of the appointment (e.g., scheduled, completed, canceled)."
        }
      },
      "required": [
        "id",
        "userId",
        "medicalProfessionalId",
        "dateTime",
        "status"
      ]
    },
    "HolisticContent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HolisticContent",
      "type": "object",
      "description": "Represents holistic wellness content.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the holistic content entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the holistic content."
        },
        "type": {
          "type": "string",
          "description": "The type of holistic content (e.g., article, video)."
        },
        "url": {
          "type": "string",
          "description": "The URL of the holistic content.",
          "format": "uri"
        },
        "description": {
          "type": "string",
          "description": "Description of the content"
        }
      },
      "required": [
        "id",
        "title",
        "type",
        "url"
      ]
    },
    "EmergencyContact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmergencyContact",
      "type": "object",
      "description": "Represents an emergency contact for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the emergency contact entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N EmergencyContact)"
        },
        "name": {
          "type": "string",
          "description": "The name of the emergency contact."
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the emergency contact."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "phone"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership enforces that only the authenticated user can access their profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user.  Corresponds to the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointments for a specific user. Path-based ownership ensures only the user can manage their appointments.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "appointmentId",
              "description": "The unique identifier of the appointment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/emergencyContacts/{contactId}",
        "definition": {
          "entityName": "EmergencyContact",
          "schema": {
            "$ref": "#/backend/entities/EmergencyContact"
          },
          "description": "Stores emergency contacts for a specific user. Path-based ownership guarantees only the user can manage their contacts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "contactId",
              "description": "The unique identifier of the emergency contact."
            }
          ]
        }
      },
      {
        "path": "/medicalProfessionals/{medicalProfessionalId}",
        "definition": {
          "entityName": "MedicalProfessional",
          "schema": {
            "$ref": "#/backend/entities/MedicalProfessional"
          },
          "description": "Stores profiles of medical professionals.  Admin roles control creation/modification.",
          "params": [
            {
              "name": "medicalProfessionalId",
              "description": "The unique identifier of the medical professional."
            }
          ]
        }
      },
      {
        "path": "/holisticContent/{holisticContentId}",
        "definition": {
          "entityName": "HolisticContent",
          "schema": {
            "$ref": "#/backend/entities/HolisticContent"
          },
          "description": "Stores holistic wellness content. Admin roles control creation/modification.",
          "params": [
            {
              "name": "holisticContentId",
              "description": "The unique identifier of the holistic content."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Marks a user as an admin.  The *existence* of a document at this path grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who is an admin."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the SanteConnect application, emphasizing secure access control, scalability, and maintainability. It leverages path-based ownership and denormalization to ensure Authorization Independence. The structure facilitates simple, robust, and easily debuggable security rules by adhering to the principles outlined in the prompt.\n\n**Authorization Independence and QAPs:**\n\n*   **Users Collection (`/users/{userId}`):**  User data is stored in a dedicated collection, enabling straightforward read/write rules based on `request.auth.uid`. The `userId` parameter in the path directly corresponds to the authenticated user's ID, providing clear ownership.\n*   **Appointments Subcollection (`/users/{userId}/appointments/{appointmentId}`):** Appointments are stored as a subcollection of users. This structure enforces that only the user can access their appointments.  This eliminates the need for complex `get()` calls in security rules.\n*   **Emergency Contacts Subcollection (`/users/{userId}/emergencyContacts/{contactId}`):** Storing emergency contacts as subcollections of users makes ownership explicit and ensures that only the user can manage their contacts.\n*   **Medical Professionals Collection (`/medicalProfessionals/{medicalProfessionalId}`):** Medical professionals are stored in a top-level collection, allowing easy listing and querying.  Security rules can control who can create/modify medical professional data (e.g., only admins).\n*   **Holistic Content Collection (`/holisticContent/{holisticContentId}`):** Holistic content is stored in a top-level collection, enabling listing and querying.  Security rules can control who can create/modify content (e.g., only admins).\n*   **Admin Roles Collection (`/roles_admin/{userId}`):** Administrative privileges are managed through the existence of documents in this collection. This 'existence over content' approach simplifies security rules for admin-only operations. The absence of custom claims reduces complexity and improves security.\n\nThis design provides a clear separation of concerns, simplifies security rules, and enables efficient data retrieval while adhering to Authorization Independence and supporting the required QAPs."
  }
}
